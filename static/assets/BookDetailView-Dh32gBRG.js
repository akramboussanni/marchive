import{d as z,u as L,r as d,s as V,e as s,f as u,g as e,t as n,l as G,n as w,A as R,C as H,y as k,z as N,o as l,_ as T}from"./index-DMTmS6cD.js";const I={class:"book-detail-view"},q={key:0,class:"loading-state"},E={key:1,class:"error-state"},J={key:2,class:"book-detail-content"},O={class:"book-detail-grid"},U={class:"book-cover-section"},P={class:"book-cover-large"},j=["src","alt"],K={key:1,class:"no-cover"},Q={class:"book-actions"},W=["disabled"],X={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Y={key:1,class:"spinner",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Z={key:2},ee={key:3},oe={key:2,class:"status-info processing"},te={key:3,class:"status-info error"},ae=["fill"],se={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},le={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},ne={key:4,class:"admin-actions"},ie=["disabled"],re=["disabled"],de={class:"book-info-section"},ue={class:"book-header"},ve={class:"book-title"},ce={class:"book-authors"},he={key:0,class:"ghost-badge-large",title:"Ghost mode - only visible to requester and admins"},ke={class:"book-metadata"},pe={key:0,class:"metadata-item"},ye={class:"metadata-value"},fe={key:1,class:"metadata-item"},me={class:"metadata-value"},be={class:"metadata-item"},ge={class:"metadata-value"},_e={class:"metadata-item"},we={class:"metadata-value"},xe={class:"metadata-item"},Ce={class:"metadata-value"},Be={key:2,class:"metadata-item"},Fe={class:"metadata-value"},Me={key:3,class:"metadata-item"},De={class:"metadata-value"},Ae=z({__name:"BookDetailView",setup(Se){const x=H(),_=N(),f=L(),t=d(null),m=d(null),b=d(!1),p=d(""),v=d(!1),r=d(!1),c=d(!1),g=d(!1),y=d(!1),C=async()=>{const a=x.params.hash;if(!a){p.value="Book not found";return}try{b.value=!0;const o=await k.getBookDetail(a);if(t.value=o.book,m.value=o.requested_by||null,f.isAuthenticated)try{const i=await k.getFavorites(1e3,0);r.value=i.books.some(h=>h.hash===a)}catch(i){console.error("Failed to load favorites:",i)}else{const i=localStorage.getItem("marchive_favorites");if(i)try{const h=JSON.parse(i);r.value=h.includes(a)}catch(h){console.error("Failed to parse local favorites:",h)}}}catch(o){console.error("Failed to load book detail:",o),p.value=o.response?.data?.message||"Failed to load book details"}finally{b.value=!1}},B=async()=>{if(!(!t.value||t.value.status!=="ready"))try{v.value=!0;const a=`http://localhost:9520/api/books/${t.value.hash}/download`,o=document.createElement("a");o.href=a,o.download=`${t.value.title}.${t.value.format}`,document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(a){console.error("Failed to download book:",a)}finally{v.value=!1}},F=async()=>{if(t.value){if(!f.isAuthenticated){const a=localStorage.getItem("marchive_favorites");let o=[];if(a)try{o=JSON.parse(a)}catch(i){console.error("Failed to parse local favorites:",i)}r.value?(o=o.filter(i=>i!==t.value.hash),r.value=!1):(o.push(t.value.hash),r.value=!0),localStorage.setItem("marchive_favorites",JSON.stringify(o));return}try{const a=await k.toggleFavorite(t.value.hash);r.value=a.is_favorited}catch(a){console.error("Failed to toggle favorite:",a)}}},M=()=>{t.value&&_.push(`/read/${t.value.hash}`)},D=async()=>{if(t.value)try{const a=`${window.location.origin}/book/${t.value.hash}`;await navigator.clipboard.writeText(a),c.value=!0,setTimeout(()=>{c.value=!1},2e3)}catch(a){console.error("Failed to copy link:",a)}},A=async()=>{if(t.value)try{g.value=!0,await k.updateGhostMode(t.value.hash,!t.value.is_ghost),t.value.is_ghost=!t.value.is_ghost}catch(a){console.error("Failed to toggle ghost mode:",a)}finally{g.value=!1}},S=async()=>{if(t.value&&confirm(`Are you sure you want to delete "${t.value.title}"? This action cannot be undone.`))try{y.value=!0,await k.deleteBook(t.value.hash),_.push("/")}catch(a){console.error("Failed to delete book:",a),alert(a.response?.data?.message||"Failed to delete book")}finally{y.value=!1}},$=a=>new Date(parseInt(a)*1e3).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return V(()=>{C()}),(a,o)=>(l(),s("div",I,[b.value?(l(),s("div",q,[...o[2]||(o[2]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading book details...",-1)])])):p.value?(l(),s("div",E,[o[3]||(o[3]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1)),e("h2",null,n(p.value),1),e("button",{onClick:o[0]||(o[0]=i=>a.$router.push("/")),class:"back-btn"}," Go Back to Library ")])):t.value?(l(),s("div",J,[e("button",{onClick:o[1]||(o[1]=i=>a.$router.push("/")),class:"back-link"},[...o[4]||(o[4]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),e("polyline",{points:"12 19 5 12 12 5"})],-1),G(" Back to Library ",-1)])]),e("div",O,[e("div",U,[e("div",P,[t.value.cover_url||t.value.cover_data?(l(),s("img",{key:0,src:t.value.cover_data||t.value.cover_url,alt:t.value.title},null,8,j)):(l(),s("div",K,[...o[5]||(o[5]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),e("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})],-1)])]))]),e("div",Q,[t.value.status==="ready"?(l(),s("button",{key:0,onClick:M,class:"primary-action-btn read-action"},[...o[6]||(o[6]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),e("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})],-1),e("span",null,"Read Book",-1)])])):u("",!0),t.value.status==="ready"?(l(),s("button",{key:1,onClick:B,class:"secondary-action-btn",disabled:v.value},[v.value?(l(),s("svg",Y,[...o[8]||(o[8]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1)])])):(l(),s("svg",X,[...o[7]||(o[7]=[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},null,-1),e("polyline",{points:"7 10 12 15 17 10"},null,-1),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"},null,-1)])])),v.value?(l(),s("span",ee,"Downloading...")):(l(),s("span",Z,"Download"))],8,W)):t.value.status==="processing"?(l(),s("div",oe,[...o[9]||(o[9]=[e("svg",{class:"spinner",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"})],-1),e("span",null,"Book is being processed...",-1)])])):t.value.status==="error"?(l(),s("div",te,[...o[10]||(o[10]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1),e("span",null,"Download failed",-1)])])):u("",!0),e("button",{onClick:F,class:w(["secondary-action-btn",{favorited:r.value}])},[(l(),s("svg",{viewBox:"0 0 24 24",fill:r.value?"currentColor":"none",stroke:"currentColor","stroke-width":"2"},[...o[11]||(o[11]=[e("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"},null,-1)])],8,ae)),e("span",null,n(r.value?"Remove from Favorites":"Add to Favorites"),1)],2),e("button",{onClick:D,class:w(["secondary-action-btn",{copied:c.value}])},[c.value?(l(),s("svg",le,[...o[13]||(o[13]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(l(),s("svg",se,[...o[12]||(o[12]=[e("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"},null,-1),e("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"},null,-1)])])),e("span",null,n(c.value?"Link Copied!":"Copy Link"),1)],2),R(f).user?.role==="admin"?(l(),s("div",ne,[e("button",{onClick:A,class:"admin-action-btn",disabled:g.value},[o[14]||(o[14]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a7 7 0 0 0-7 7v3l-2 2v5h18v-5l-2-2V9a7 7 0 0 0-7-7z"}),e("path",{d:"M8.5 19a4 4 0 0 0 7 0"})],-1)),e("span",null,n(t.value.is_ghost?"Disable Ghost Mode":"Enable Ghost Mode"),1)],8,ie),e("button",{onClick:S,class:"admin-action-btn delete-btn",disabled:y.value},[o[15]||(o[15]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)),e("span",null,n(y.value?"Deleting...":"Delete Book"),1)],8,re)])):u("",!0)])]),e("div",de,[e("div",ue,[e("div",null,[e("h1",ve,n(t.value.title),1),e("p",ce,n(t.value.authors||"Unknown Author"),1)]),t.value.is_ghost?(l(),s("div",he,[...o[16]||(o[16]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 2a7 7 0 0 0-7 7v3l-2 2v5h18v-5l-2-2V9a7 7 0 0 0-7-7z"}),e("path",{d:"M8.5 19a4 4 0 0 0 7 0"}),e("circle",{cx:"12",cy:"11",r:"1",fill:"currentColor"})],-1),e("span",null,"Ghost Mode",-1)])])):u("",!0)]),e("div",ke,[t.value.publisher?(l(),s("div",pe,[o[17]||(o[17]=e("span",{class:"metadata-label"},"Publisher",-1)),e("span",ye,n(t.value.publisher),1)])):u("",!0),t.value.language?(l(),s("div",fe,[o[18]||(o[18]=e("span",{class:"metadata-label"},"Language",-1)),e("span",me,n(t.value.language),1)])):u("",!0),e("div",be,[o[19]||(o[19]=e("span",{class:"metadata-label"},"Format",-1)),e("span",ge,n(t.value.format),1)]),e("div",_e,[o[20]||(o[20]=e("span",{class:"metadata-label"},"Size",-1)),e("span",we,n(t.value.size),1)]),e("div",xe,[o[21]||(o[21]=e("span",{class:"metadata-label"},"Downloads",-1)),e("span",Ce,n(t.value.download_count??0),1)]),t.value.created_at?(l(),s("div",Be,[o[22]||(o[22]=e("span",{class:"metadata-label"},"Added",-1)),e("span",Fe,n($(t.value.created_at)),1)])):u("",!0),m.value?(l(),s("div",Me,[o[23]||(o[23]=e("span",{class:"metadata-label"},"Requested By",-1)),e("span",De,n(m.value.username),1)])):u("",!0)])])])])):u("",!0)]))}}),ze=T(Ae,[["__scopeId","data-v-ed06e134"]]);export{ze as default};
