import{d as T,c as B,a as C,T as j,w as V,b as E,e as c,f as $,g as e,t as _,n as L,h as N,o as a,_ as F,r as p,i as G,j as ne,k as M,l as H,v as A,m as D,p as ie,q as S,F as I,u as re,s as de,x as ce,y as b,z as ue,B as q,A as ve}from"./index-DMTmS6cD.js";const he={class:"dialog-header"},fe={key:0,class:"dialog-icon danger",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},pe={key:1,class:"dialog-icon warning",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},ye={key:2,class:"dialog-icon info",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},me={class:"dialog-content"},ge={class:"dialog-title"},ke={class:"dialog-message"},xe={class:"dialog-actions"},we=T({__name:"ConfirmDialog",props:{isOpen:{type:Boolean},title:{},message:{},confirmText:{default:"Confirm"},cancelText:{default:"Cancel"},variant:{default:"info"}},emits:["confirm","cancel"],setup(y,{emit:k}){const v=k,i=()=>{v("confirm")},h=()=>{v("cancel")};return(f,r)=>(a(),B(E,{to:"body"},[C(j,{name:"modal"},{default:V(()=>[y.isOpen?(a(),c("div",{key:0,class:"modal-overlay",onClick:h},[e("div",{class:"confirm-dialog",onClick:r[0]||(r[0]=N(()=>{},["stop"]))},[e("div",he,[y.variant==="danger"?(a(),c("svg",fe,[...r[1]||(r[1]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"},null,-1),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"},null,-1)])])):y.variant==="warning"?(a(),c("svg",pe,[...r[2]||(r[2]=[e("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"},null,-1),e("line",{x1:"12",y1:"9",x2:"12",y2:"13"},null,-1),e("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"},null,-1)])])):(a(),c("svg",ye,[...r[3]||(r[3]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("line",{x1:"12",y1:"16",x2:"12",y2:"12"},null,-1),e("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"},null,-1)])]))]),e("div",me,[e("h3",ge,_(y.title),1),e("p",ke,_(y.message),1)]),e("div",xe,[e("button",{class:"dialog-btn cancel-btn",onClick:h},_(y.cancelText),1),e("button",{class:L(["dialog-btn confirm-btn",{danger:y.variant==="danger"}]),onClick:i},_(y.confirmText),3)])])])):$("",!0)]),_:1})]))}}),be=F(we,[["__scopeId","data-v-63dcf22f"]]),_e={class:"dialog-content"},Ce={class:"form-group"},Be={class:"form-group"},$e={class:"form-group"},Te={key:0,class:"error-message"},Fe={class:"dialog-actions"},Oe=["disabled"],Me=T({__name:"EditMetadataDialog",props:{isOpen:{type:Boolean},title:{},authors:{},publisher:{}},emits:["save","cancel"],setup(y,{emit:k}){const v=y,i=k,h=p(""),f=p(""),r=p(""),n=p(""),d=G(()=>h.value.trim().length>0);ne(()=>v.isOpen,g=>{g&&(h.value=v.title,f.value=v.authors,r.value=v.publisher,n.value="")});const u=()=>{if(!d.value){n.value="Title is required";return}i("save",{title:h.value.trim(),authors:f.value.trim(),publisher:r.value.trim()})},m=()=>{i("cancel")};return(g,l)=>(a(),B(E,{to:"body"},[C(j,{name:"modal"},{default:V(()=>[y.isOpen?(a(),c("div",{key:0,class:"modal-overlay",onClick:m},[e("div",{class:"edit-dialog",onClick:l[3]||(l[3]=N(()=>{},["stop"]))},[e("div",{class:"dialog-header"},[l[5]||(l[5]=e("h3",null,"Edit Book Metadata",-1)),e("button",{onClick:m,class:"close-btn",title:"Close"},[...l[4]||(l[4]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",_e,[e("div",Ce,[l[6]||(l[6]=e("label",{for:"title",class:"form-label"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),e("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]),H(" Title ")],-1)),M(e("input",{id:"title","onUpdate:modelValue":l[0]||(l[0]=x=>h.value=x),type:"text",class:"form-input",placeholder:"Enter book title",onKeydown:D(u,["enter"])},null,544),[[A,h.value]])]),e("div",Be,[l[7]||(l[7]=e("label",{for:"authors",class:"form-label"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})]),H(" Authors ")],-1)),M(e("input",{id:"authors","onUpdate:modelValue":l[1]||(l[1]=x=>f.value=x),type:"text",class:"form-input",placeholder:"Enter authors",onKeydown:D(u,["enter"])},null,544),[[A,f.value]])]),e("div",$e,[l[8]||(l[8]=e("label",{for:"publisher",class:"form-label"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e("polyline",{points:"9 22 9 12 15 12 15 22"})]),H(" Publisher ")],-1)),M(e("input",{id:"publisher","onUpdate:modelValue":l[2]||(l[2]=x=>r.value=x),type:"text",class:"form-input",placeholder:"Enter publisher",onKeydown:D(u,["enter"])},null,544),[[A,r.value]])]),n.value?(a(),c("div",Te,[l[9]||(l[9]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1)),e("span",null,_(n.value),1)])):$("",!0)]),e("div",Fe,[e("button",{class:"dialog-btn cancel-btn",onClick:m}," Cancel "),e("button",{class:"dialog-btn save-btn",onClick:u,disabled:!d.value}," Save Changes ",8,Oe)])])])):$("",!0)]),_:1})]))}}),He=F(Me,[["__scopeId","data-v-ded11338"]]),Ae=["onClick"],De={class:"toast-icon"},Se={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Ie={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Ve={key:2,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Ee={key:3,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Le={class:"toast-content"},Ne={class:"toast-message"},Re=["onClick"],ze=T({__name:"NotificationToast",setup(y,{expose:k}){const v=p([]);let i=1;const h=(r,n="info",d=4e3)=>{const u=i++;v.value.push({id:u,message:r,type:n,duration:d}),d>0&&setTimeout(()=>{f(u)},d)},f=r=>{const n=v.value.findIndex(d=>d.id===r);n>-1&&v.value.splice(n,1)};return k({addToast:h,removeToast:f}),(r,n)=>(a(),B(E,{to:"body"},[C(ie,{name:"toast"},{default:V(()=>[(a(!0),c(I,null,S(v.value,d=>(a(),c("div",{key:d.id,class:L(["toast-notification",[`toast-${d.type}`]]),onClick:u=>f(d.id)},[e("div",De,[d.type==="success"?(a(),c("svg",Se,[...n[0]||(n[0]=[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1),e("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)])])):d.type==="error"?(a(),c("svg",Ie,[...n[1]||(n[1]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"},null,-1),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"},null,-1)])])):d.type==="warning"?(a(),c("svg",Ve,[...n[2]||(n[2]=[e("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"},null,-1),e("line",{x1:"12",y1:"9",x2:"12",y2:"13"},null,-1),e("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"},null,-1)])])):(a(),c("svg",Ee,[...n[3]||(n[3]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("line",{x1:"12",y1:"16",x2:"12",y2:"12"},null,-1),e("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"},null,-1)])]))]),e("div",Le,[e("p",Ne,_(d.message),1)]),e("button",{class:"toast-close",onClick:N(u=>f(d.id),["stop"])},[...n[4]||(n[4]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Re)],10,Ae))),128))]),_:1})]))}}),Pe=F(ze,[["__scopeId","data-v-c2777e53"]]),Ue={class:"home-view"},Ke={class:"content"},Je={key:0,class:"favorites-section"},qe={class:"books-grid"},je={class:"library-section"},Ge={class:"section-header"},Qe={class:"header-actions"},We=["disabled"],Xe={key:0,class:"loading-state"},Ye={key:1,class:"books-grid"},Ze={key:2,class:"books-grid"},eo={key:3,class:"load-more"},oo=["disabled"],to={key:0},so={key:1,class:"spinner-small"},lo=T({__name:"HomeView",setup(y){const k=ue(),v=re(),i=p([]),h=p(!1),f=p(!1),r=p(new Set);let n=null;const d=p(null),u=p({isOpen:!1,title:"",message:"",bookHash:""}),m=p({isOpen:!1,title:"",authors:"",publisher:"",bookHash:""}),g=p({limit:20,offset:0,total:0,has_next:!1}),l=p(new Set),x=G(()=>i.value.filter(o=>l.value.has(o.hash))),Q=o=>l.value.has(o),O=async()=>{try{h.value=!0;const o=await b.getBooks(20,0);i.value=o.books,g.value=o.pagination}catch(o){console.error("Failed to load books:",o)}finally{h.value=!1}},R=async()=>{if(!v.isAuthenticated){const o=localStorage.getItem("marchive_favorites");if(o)try{const t=JSON.parse(o);l.value=new Set(t)}catch(t){console.error("Failed to parse local favorites:",t)}return}try{const o=await b.getFavorites(20,0);l.value=new Set(o.books.map(t=>t.hash))}catch(o){console.error("Failed to load favorites:",o)}},W=async()=>{if(!(f.value||!g.value.has_next))try{f.value=!0;const o=g.value.offset+g.value.limit,t=await b.getBooks(20,o);i.value.push(...t.books),g.value=t.pagination}catch(o){console.error("Failed to load more books:",o)}finally{f.value=!1}},z=async o=>{if(!v.isAuthenticated){const t=localStorage.getItem("marchive_favorites");let s=[];if(t)try{s=JSON.parse(t)}catch(w){console.error("Failed to parse local favorites:",w)}l.value.has(o.hash)?(s=s.filter(w=>w!==o.hash),l.value.delete(o.hash)):(s.push(o.hash),l.value.add(o.hash)),localStorage.setItem("marchive_favorites",JSON.stringify(s));return}try{(await b.toggleFavorite(o.hash)).is_favorited?l.value.add(o.hash):l.value.delete(o.hash)}catch(t){console.error("Failed to toggle favorite:",t)}},P=async o=>{if(o.status!=="ready"){console.log("Book is not ready yet, status:",o.status);return}try{r.value.add(o.hash);const t=`http://localhost:9520/api/books/${o.hash}/download`,s=document.createElement("a");s.href=t,s.download=`${o.title}.${o.format}`,document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(t){console.error("Failed to download book:",t)}finally{r.value.delete(o.hash)}},U=o=>{console.log("Open book:",o.title)},K=o=>{k.push(`/read/${o.hash}`)},X=o=>{k.push(`/book/${o.hash}`)},Y=o=>{m.value={isOpen:!0,title:o.title,authors:o.authors,publisher:o.publisher,bookHash:o.hash}},Z=async o=>{const t=m.value.bookHash;m.value.isOpen=!1;try{await b.updateBookMetadata(t,o.title,o.authors,o.publisher);const s=i.value.findIndex(w=>w.hash===t);s!==-1&&i.value[s]&&(i.value[s].title=o.title,i.value[s].authors=o.authors,i.value[s].publisher=o.publisher),d.value?.addToast("Book metadata updated successfully!","success")}catch(s){console.error("Failed to update book metadata:",s),d.value?.addToast("Failed to update book metadata","error")}},ee=()=>{m.value.isOpen=!1},oe=o=>{u.value={isOpen:!0,title:"Delete Book",message:`Are you sure you want to delete "${o.title}"? This action cannot be undone.`,bookHash:o.hash}},te=async()=>{const o=u.value.bookHash;u.value.isOpen=!1;try{await b.deleteBook(o),i.value=i.value.filter(t=>t.hash!==o),l.value.delete(o),d.value?.addToast("Book deleted successfully!","success")}catch(t){console.error("Failed to delete book:",t),d.value?.addToast("Failed to delete book","error")}},se=()=>{u.value.isOpen=!1},le=async()=>{await Promise.all([O(),R()])},ae=()=>{i.value.some(s=>s.status==="processing")&&!n&&(n=setInterval(()=>{O(),i.value.some(s=>s.status==="processing")||J()},5e3)),i.value.filter(s=>s.status==="error").forEach(s=>{setTimeout(()=>{i.value=i.value.filter(w=>w.hash!==s.hash)},1e4)})},J=()=>{n&&(clearInterval(n),n=null)};return de(()=>{O().then(()=>ae()),R()}),ce(()=>{J()}),(o,t)=>(a(),c("div",Ue,[e("main",Ke,[t[6]||(t[6]=e("div",{class:"welcome-section"},[e("h1",{class:"welcome-title"},"Library"),e("p",{class:"welcome-subtitle"},"Browse and discover books")],-1)),x.value.length>0?(a(),c("section",Je,[t[0]||(t[0]=e("div",{class:"section-header"},[e("h2",null,"Favorites"),e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})])],-1)),e("div",qe,[(a(!0),c(I,null,S(x.value,s=>(a(),B(q,{key:s.hash,book:s,"is-favorited":!0,"is-downloading":r.value.has(s.hash),onToggleFavorite:z,onDownload:P,onOpen:U,onRead:K},null,8,["book","is-downloading"]))),128))])])):$("",!0),e("section",je,[e("div",Ge,[t[3]||(t[3]=e("h2",null,"All Books",-1)),e("div",Qe,[e("button",{class:"refresh-btn",onClick:le,disabled:h.value,title:"Refresh library"},[(a(),c("svg",{class:L({spinning:h.value}),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...t[1]||(t[1]=[e("polyline",{points:"23 4 23 10 17 10"},null,-1),e("polyline",{points:"1 20 1 14 7 14"},null,-1),e("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"},null,-1)])],2))],8,We),t[2]||(t[2]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),e("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})],-1))])]),h.value?(a(),c("div",Xe,[...t[4]||(t[4]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading books...",-1)])])):i.value.length>0?(a(),c("div",Ye,[(a(!0),c(I,null,S(i.value,s=>(a(),B(q,{key:s.hash,book:s,"is-favorited":Q(s.hash),"is-downloading":r.value.has(s.hash),"show-admin-controls":ve(v).user?.role==="admin",onToggleFavorite:z,onDownload:P,onOpen:U,onRead:K,onView:X,onEdit:Y,onDelete:oe},null,8,["book","is-favorited","is-downloading","show-admin-controls"]))),128))])):(a(),c("div",Ze,[...t[5]||(t[5]=[e("p",{class:"empty-state"},"No books in library",-1)])])),g.value.has_next?(a(),c("div",eo,[e("button",{onClick:W,disabled:f.value,class:"load-more-btn"},[f.value?(a(),c("div",so)):(a(),c("span",to,"Load More"))],8,oo)])):$("",!0)])]),C(be,{"is-open":u.value.isOpen,title:u.value.title,message:u.value.message,"confirm-text":"Delete","cancel-text":"Cancel",variant:"danger",onConfirm:te,onCancel:se},null,8,["is-open","title","message"]),C(He,{"is-open":m.value.isOpen,title:m.value.title,authors:m.value.authors,publisher:m.value.publisher,onSave:Z,onCancel:ee},null,8,["is-open","title","authors","publisher"]),C(Pe,{ref_key:"toastRef",ref:d},null,512)]))}}),no=F(lo,[["__scopeId","data-v-25cf5443"]]);export{no as default};
